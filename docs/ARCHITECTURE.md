# 电商数据管理系统架构文档

## 系统架构概述

本系统采用微服务架构，基于Docker容器化技术实现，包含前端、后端、数据库三层架构。

## 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                         用户层                               │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      前端服务层                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Nginx (Alpine)                                       │  │
│  │  - 静态资源服务                                        │  │
│  │  - 反向代理                                           │  │
│  │  - 负载均衡                                           │  │
│  │  - Gzip压缩                                           │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      后端服务层                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Spring Boot Application                              │  │
│  │  - RESTful API                                        │  │
│  │  - 业务逻辑处理                                        │  │
│  │  - 数据验证                                           │  │
│  │  - 事务管理                                           │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据持久层                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  MySQL 8.0                                            │  │
│  │  - 数据存储                                           │  │
│  │  - 事务支持                                           │  │
│  │  - 数据持久化                                         │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 技术栈

### 前端
- **Nginx 1.25-alpine**: 轻量级Web服务器
- **HTML5/CSS3/JavaScript**: 原生前端技术
- **响应式设计**: 支持多设备访问

### 后端
- **Spring Boot 3.1.5**: Java企业级应用框架
- **Spring Data JPA**: ORM框架
- **Spring Web**: RESTful API支持
- **Spring Actuator**: 健康检查和监控
- **Maven**: 项目构建工具

### 数据库
- **MySQL 8.0**: 关系型数据库
- **InnoDB引擎**: 支持事务和外键
- **UTF8MB4字符集**: 支持完整Unicode

### 容器化
- **Docker**: 容器运行时
- **Docker Compose**: 容器编排
- **多阶段构建**: 优化镜像大小

### CI/CD
- **Jenkins**: 持续集成/持续部署
- **Git**: 版本控制

### 扩展功能
- **Kubernetes**: 容器编排平台
- **Prometheus**: 监控系统
- **Grafana**: 可视化平台

## 网络架构

### Docker网络
- **网络类型**: Bridge
- **网络名称**: ecommerce-network
- **子网**: 172.20.0.0/16
- **DNS解析**: 容器间通过服务名通信

### 端口映射
| 服务 | 容器端口 | 主机端口 | 协议 |
|------|---------|---------|------|
| Frontend | 80 | 80 | HTTP |
| Backend | 8080 | 8080 | HTTP |
| MySQL | 3306 | 3306 | TCP |
| Prometheus | 9090 | 9090 | HTTP |
| Grafana | 3000 | 3000 | HTTP |

## 数据流

### 请求流程
1. 用户通过浏览器访问前端页面 (http://localhost:80)
2. 前端发送API请求到Nginx
3. Nginx反向代理请求到后端服务 (http://backend:8080)
4. 后端处理业务逻辑，访问MySQL数据库
5. 数据库返回结果给后端
6. 后端返回JSON响应给前端
7. 前端渲染数据展示给用户

### 数据持久化
- MySQL数据存储在Docker Volume: `mysql-data`
- 数据库初始化脚本自动执行
- 支持数据备份和恢复

## 安全设计

### 网络安全
- 容器间通信限制在自定义网络内
- 数据库不直接暴露到公网
- 使用环境变量管理敏感信息

### 应用安全
- 输入验证和数据校验
- SQL注入防护（JPA参数化查询）
- CORS跨域配置

### 容器安全
- 使用非root用户运行应用
- 最小化镜像体积
- 定期更新基础镜像

## 性能优化

### 前端优化
- Gzip压缩
- 静态资源缓存
- CDN加速（可选）

### 后端优化
- 数据库连接池（HikariCP）
- JPA查询优化
- 缓存机制（可扩展Redis）

### 数据库优化
- 索引优化
- 查询优化
- 连接池配置

## 监控和日志

### 健康检查
- 前端: `/health`
- 后端: `/actuator/health`
- 数据库: `mysqladmin ping`

### 日志管理
- 应用日志输出到标准输出
- Docker日志驱动收集
- 日志级别可配置

### 监控指标
- CPU使用率
- 内存使用率
- 请求响应时间
- 数据库连接数
- 错误率

## 扩展性

### 水平扩展
- 前端和后端支持多实例部署
- 负载均衡配置
- 无状态设计

### 垂直扩展
- 资源限制可调整
- 支持更大的数据库实例

## 高可用设计

### 服务高可用
- 多副本部署
- 健康检查和自动重启
- 滚动更新

### 数据高可用
- 数据持久化
- 定期备份
- 主从复制（可扩展）

## 部署策略

### 蓝绿部署
- 同时运行两个版本
- 快速切换和回滚
- 零停机部署

### 金丝雀部署
- 渐进式发布
- 流量控制
- 风险降低
